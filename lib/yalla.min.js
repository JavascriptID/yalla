"use strict";function _taggedTemplateLiteral(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_templateObject=_taggedTemplateLiteral(['<span id="','" style="display: none">outlet</span>'],['<span id="','" style="display: none">outlet</span>']);!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=t():(e.yalla=t(),e.Context=e.yalla.Context,e.render=e.yalla.render,e.plug=e.yalla.plug)}("undefined"!=typeof self?self:eval("this"),function(){var e="chrome"in window&&"webstore"in window.chrome,t=function(){function e(){var t=this;_classCallCheck(this,e),this.cacheInstance={},this.syncCallbackStack=[],this.html=function(e){for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];return new p(e,o,t)},this.htmlCollection=function(e,n,o){return new f(e,n,o,t)}}return _createClass(e,[{key:"hasCache",value:function(e){return e in this.cacheInstance}},{key:"cache",value:function(e,t){return this.hasCache(e)||(this.cacheInstance[e]=t),this.cacheInstance[e]}},{key:"addSyncCallback",value:function(e){this.syncCallbackStack.push(e)}},{key:"clearSyncCallbacks",value:function(){this.syncCallbackStack.forEach(function(e){return e.apply()}),this.syncCallbackStack=[]}}]),e}(),n=function t(n){if(e)return n.cloneNode(!0);for(var o=3===n.nodeType?document.createTextNode(n.nodeValue):n.cloneNode(!1),i=n.firstChild;i;)o.appendChild(t(i)),i=i.nextSibling;return o},o=function(e){return"object"===(void 0===e?"undefined":_typeof(e))&&"constructor"in e&&"Promise"===e.constructor.name},i=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},r=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"destroy",value:function(){throw new Error("Please implement template.destroy ")}}]),e}(),a={INPUT:["VALUE"]},s=function(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),!!a[t]&&a[t].indexOf(e)>=0},l={col:"colgroup",td:"tr",area:"map",tbody:"table",tfoot:"table",th:"tr",thead:"table",tr:"tbody",caption:"table",colgroup:"table",li:"ul",g:"svg",circle:"svg",rect:"svg",polygon:"svg",eclipse:"svg",text:"svg"},c=function(e){return["checked","compact","declare","defer","disabled","ismap","noresize","noshade","nowrap","selected"].indexOf(e.nodeName)>=0},u=function e(t){if(t.nodeType===Node.ATTRIBUTE_NODE)return e(t.ownerElement).concat([{name:t.nodeName}]);for(var n=0,o=t;null!==(o=o.previousSibling);)n++;var i=[];return i.push(n),t.parentNode&&t.parentNode.parentNode?e(t.parentNode).concat(i):i},d=function(e,t){return e.reduce(function(e,t){return"number"==typeof t?e.childNodes[t]:e.attributes[t.name]},t)},h=function(e,t,n){var o=e,i=t.map(function(e){return n[e]});return t.forEach(function(e,t){o=o.replace("\x3c!--"+e+"--\x3e",i[t])}),o},f=function(e){function t(e,n,o,i){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.items=e,r.keyFn="string"==typeof n?function(e){return e[n]}:n,r.templateFn=o,r.context=i,r.keys=[],r.templates={},r.initialzed=!1,r}return _inherits(t,r),_createClass(t,[{key:"iterateRight",value:function(e){if(this.initialzed)for(var t=this.keys.length-1;t>=0;){var n=this.items[t],o=this.keys[t],i=this.templates[o];e&&e.apply(null,[n,o,i,t]),t--}else{for(var r=this.items.length-1;r>=0;){var a=this.items[r],s=this.keyFn.apply(this,[a,r]),l=this.templateFn.apply(this,[a,r]);e&&e.apply(null,[a,s,l,r]),r--,this.keys.push(s),this.templates[s]=l}this.initialzed=!0,this.keys.reverse()}}}]),t}(),m=function(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)&&e.length===t.length){for(var n=!0,o=0;o<t.length;o++)if(!(n=n&&e[o]===t[o]))return!1;return!0}return!1},p=function(e){function t(e,n,o){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.strings=e,i.values=n,i.context=o,i.key=i.strings.join("").trim(),i.nodeValueIndexArray=null,i.documentFragment=null,i}return _inherits(t,r),_createClass(t,[{key:"buildTemplate",value:function(e){this.documentFragment=t.getProperTemplateTag(e),this.nodeValueIndexArray=this.buildNodeValueIndex(this.documentFragment,this.documentFragment.nodeName),t.applyValues(this,this.nodeValueIndexArray)}},{key:"buildNodeValueIndex",value:function(e,n){var o=[],i=e.childNodes[0];if(void 0===i)return o;do{if(i.nodeType===Node.ELEMENT_NODE){for(var r=i.attributes,a=r.length,s=0;s<a;s++){var l=r[s].nodeValue,c=t.lookNodeValueArray(l).map(function(e){return e.match(/[\w\.]+/)[0]}).map(function(e){return parseInt(e)});c&&c.length>0&&o.push({node:r[s],valueIndexes:c,nodeValue:l})}o=o.concat(this.buildNodeValueIndex(i,i.nodeName))}if(i.nodeType===Node.TEXT_NODE&&"STYLE"===n.toUpperCase()){var u=i.nodeValue,d=t.lookNodeValueArray(u).map(function(e){return e.match(/[\w\.]+/)[0]}).map(function(e){return parseInt(e)});d&&d.length>0&&o.push({node:i,valueIndexes:d,nodeValue:u})}if(i.nodeType===Node.COMMENT_NODE){var h=i.nodeValue;i.nodeValue="outlet",o.push({node:i,valueIndexes:parseInt(h)})}}while(i=i.nextSibling);return o}},{key:"constructTemplate",value:function(){if(!this.context.hasCache(this.key)){var e=this.buildStringSequence();return this.buildTemplate(e),this.context.cache(this.key,this)}return this.context.cache(this.key)}},{key:"buildStringSequence",value:function(){return this.strings.reduce(function(e,t,n){return 0===n?t:e+"\x3c!--"+(n-1)+"--\x3e"+t},"").trim()}}],[{key:"lookNodeValueArray",value:function(e){for(var t=[],n=e.indexOf("\x3c!--"),o=e.indexOf("--\x3e",n);o<e.length&&o>=0&&n>=0;)t.push(e.substring(n+4,o)),n=e.indexOf("\x3c!--",o+3),o=e.indexOf("--\x3e",n);return t}},{key:"getProperTemplateTag",value:function(e){var t=e.substring(1,e.indexOf(">"));t=(t.indexOf(" ")>0?t.substring(0,t.indexOf(" ")):t).toLowerCase();var n=l[t];n=n||"div";var o=document.createElement(n);return o.innerHTML=e,o}},{key:"applyValues",value:function(e,t){var n=e.values;t&&t.forEach(function(e){var t=e.node,o=e.valueIndexes,i=e.values,r=Array.isArray(o)?o.map(function(e){return n[e]}):n[o],a=t.nodeName,l=t.nodeType===Node.ATTRIBUTE_NODE&&0===a.indexOf("on");if(!(m(r,i)||l&&r[0].name)){if(t.nodeType===Node.ATTRIBUTE_NODE){var u=g.from(t),d=e.nodeValue;if(l){var f=o[0];t.ownerElement[a]=n[f],u.attributes[a]=n[f]}else{var p=h(d,o,n);if(c(t)?(t.ownerElement[a]="true"===p.trim(),t.ownerElement.setAttribute(a,"")):(t.ownerElement.setAttribute(a,p),s(a,t.ownerElement.nodeName)&&(t.ownerElement[a]=p)),a.indexOf(".bind")>=0){var y=a.substring(0,a.indexOf(".bind"));t.ownerElement.setAttribute(y,p)}u.attributes[a]=p}}if(t.nodeType===Node.TEXT_NODE&&(t.nodeValue=h(e.nodeValue,o,n)),t.nodeType===Node.COMMENT_NODE){var v=n[o];T.from(t).setContent(v)}e.values=r}})}}]),t}(),y=function(e){function t(e,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.template=e,o.outlet=n,o.instance=null,o}return _inherits(t,r),_createClass(t,[{key:"applyValues",value:function(e){var n=this;if(null===this.instance){this.instance={};var o=this.outlet.commentNode;e.iterateRight(function(e,t,i){var r=T.from(document.createComment("outlet-child"));o.parentNode.insertBefore(r.commentNode,o),T.from(r.commentNode).setContent(i),o=r.firstChildNode(),n.instance[t]=r.commentNode})}else{if(e.iterateRight(),0===e.items.length){if(this.outlet.commentNode.parentNode.$htmlCollectionInstanceChild&&1===this.outlet.commentNode.parentNode.$htmlCollectionInstanceChild.length){var i=this.outlet.commentNode.parentNode;i.innerText="",i.appendChild(this.outlet.commentNode),this.instance={}}}else this.template.keys.forEach(function(t){if(e.keys.indexOf(t)<0){var o=n.instance[t];T.from(o).clearContent(),o.remove(),delete n.instance[t]}});var r=this.outlet.commentNode;e.iterateRight(function(e,o,i){var a=n.instance[o];if(a){var s=T.from(a);s.content instanceof v?s.setHtmlTemplateContent(i):s.content instanceof t?s.setHtmlTemplateCollectionContent(i):s.setTextContent(i),r.previousSibling!==a&&(r.parentNode.insertBefore(a,r),s.validateInstancePosition()),r=s.firstChildNode()}else{var l=T.from(document.createComment("outlet-child"));r.parentNode.insertBefore(l.commentNode,r),T.from(l.commentNode).setContent(i),r=l.firstChildNode(),n.instance[o]=l.commentNode,n.template.context.addSyncCallback(function(){return b(i,l.commentNode)})}}),this.template=e}}},{key:"destroy",value:function(){var e=this;this.template.keys.forEach(function(t){var n=e.instance[t];T.from(n).clearContent(),n.remove(),delete e.instance[t]}),this.outlet=null,this.instance=null,this.template=null}}]),t}(),v=function(e){function t(e,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.template=e,o.outlet=n,o.instance=[],o.nodeValueIndexArray=null,o}return _inherits(t,r),_createClass(t,[{key:"applyValues",value:function(e){if(null===this.instance||0===this.instance.length){p.applyValues(e,this.template.nodeValueIndexArray);var t=this.template.documentFragment,o=n(t),i=this.outlet.commentNode,r=o.childNodes[0],a=null;do{this.instance.push(r),a=r.nextSibling,i.parentNode.insertBefore(r,i)}while(r=a)}else this.nodeValueIndexArray&&p.applyValues(e,this.nodeValueIndexArray)}},{key:"destroy",value:function(){this.instance.forEach(function(e){return e.remove()}),this.nodeValueIndexArray=null,this.outlet=null,this.template=null}}]),t}(),C=function(e,t,n,o){var i=g.from(e),r=e.nodeName;if(0===r.indexOf("on")){var a=t[0];i.attributes[r]=n[a],e.ownerElement.setAttribute(r,"return false;"),e.ownerElement[r]=n[a]}else i.attributes[r]=h(o,t,n)},x=function(e,t,n){var o=T.from(e),i=t[n];i instanceof p?(o.constructHtmlTemplateContent(i),b(i,o.commentNode)):i instanceof f?(o.constructHtmlTemplateCollectionContent(i),b(i,o.commentNode)):o.constructTextContent()},N=function(e,t,n){var o=e.nodeValue,i=e.valueIndexes,r=u(e.node),a=d(r,t),s=Array.isArray(i)?i.map(function(e){return n[e]}):n[i];return a.parentNode&&"STYLE"===a.parentNode.nodeName.toUpperCase()?{node:a,valueIndexes:i,nodeValue:o,values:s}:a.nodeType===Node.ATTRIBUTE_NODE?(C(a,i,n,o),{node:a,valueIndexes:i,nodeValue:o,values:s}):(x(a,n,i),{node:a,valueIndexes:i,values:s})},b=function e(t,n){var o=T.from(n);if(o.content&&o.content instanceof v){var i=o.content,r=i.template,a=t.values,s={childNodes:i.instance};if(null===r.nodeValueIndexArray){var l=r.context.cache(r.key);s={childNodes:o.content.instance},i.nodeValueIndexArray=l.nodeValueIndexArray.map(function(e){return N(e,s,a)})}else i.nodeValueIndexArray=r.nodeValueIndexArray.map(function(e){return N(e,s,a)})}if(o.content&&o.content instanceof y){var c=o.content,u=c.template.templates,d=c.template.keys;o.commentNode.parentNode.$htmlCollectionInstanceChild=o.commentNode.parentNode.$htmlCollectionInstanceChild||[],o.commentNode.parentNode.$htmlCollectionInstanceChild.push(o.commentNode),d.forEach(function(t){var n=u[t],o=c.instance[t],i=T.from(o);null===i.content?n instanceof p&&(i.constructHtmlTemplateContent(n.context.cache(n.key)),e(n,o)):i.content instanceof v&&e(n,o)})}},g=function(){function e(t){_classCallCheck(this,e),this.node=t,this.attributes={}}return _createClass(e,null,[{key:"from",value:function(t){var n=t;return t.nodeType===Node.ATTRIBUTE_NODE&&(n=t.ownerElement),n.$data=n.$data||new e(n),n.$data}}]),e}(),k=(new t).html,T=function(){function e(t){_classCallCheck(this,e),this.commentNode=t,this.content=null}return _createClass(e,[{key:"constructTextContent",value:function(){this.content=this.commentNode.previousSibling}},{key:"constructHtmlTemplateCollectionContent",value:function(e){var t=this;this.content=new y(e,this),this.content.instance={};var n=this.commentNode;e.iterateRight(function(e,o){do{n=n.previousSibling}while(n.nodeType!==Node.COMMENT_NODE&&"outlet-child"!==n.nodeValue);t.content.instance[o]=n})}},{key:"constructHtmlTemplateContent",value:function(e){var t=e.context.cache(e.key).documentFragment.childNodes.length;this.content=new v(e,this);for(var n=this.commentNode;t--;)n=n.previousSibling,this.content.instance.push(n);this.content.instance.reverse()}},{key:"setContent",value:function(t){var n=this;if(o(t))if(null===this.content){var r=this,a=i();this.setHtmlTemplateContent(k(_templateObject,a)),t.then(function(t){var n=document.getElementById(a).nextSibling;e.from(n).setContent(t),r.clearContent()})}else t.then(function(e){n.setContent(e)});else t instanceof _?t.factory.apply(null,[this]):t instanceof p?this.setHtmlTemplateContent(t):t instanceof f?this.setHtmlTemplateCollectionContent(t):this.setTextContent(t)}},{key:"setTextContent",value:function(e){this.content instanceof Text?this.content.nodeValue=e:(this.clearContent(),this.content=document.createTextNode(e),this.commentNode.parentNode.insertBefore(this.content,this.commentNode))}},{key:"setHtmlTemplateCollectionContent",value:function(e){var t=!1;!this.content||this.content instanceof y||(t=!0,this.clearContent()),this.content=this.content||new y(e,this),this.content.applyValues(e),t&&b(e,this.commentNode)}},{key:"setHtmlTemplateContent",value:function(e){var t=!1,n=!!(this.content&&this.content instanceof v)&&this.content.template.key===e.key;if(null===this.content||n||(this.clearContent(),t=!0),!this.content){var o=e.constructTemplate();this.content=new v(o,this)}this.content.applyValues(e),t&&b(e,this.commentNode)}},{key:"clearContent",value:function(){null!==this.content&&(this.content instanceof r?this.content.destroy():this.content.remove(),this.content=null)}},{key:"firstChildNode",value:function(){if(this.content instanceof v)return this.content.instance[0];if(this.content instanceof y){var t=this.content.template.keys[0];return e.from(this.content.instance[t]).firstChildNode()}return this.content}},{key:"validateInstancePosition",value:function(){this.content instanceof v?this.content.instance.reduceRight(function(e,t){return e.previousSibling!==t&&e.parentNode.insertBefore(t,e),t},this.commentNode):this.content instanceof y||this.commentNode.previousSibling!==this.content&&this.commentNode.parentNode.insertBefore(this.content,this.commentNode)}}],[{key:"from",value:function(t){return t instanceof Comment?(t.$data=t.$data||new e(t),t.$data):(t.$outlet||(t.$outlet=document.createComment("outlet"),t.appendChild(t.$outlet)),e.from(t.$outlet))}}]),e}(),_=function e(t){_classCallCheck(this,e),this.factory=t};return{Context:t,render:function(e,t){var n=function(){T.from(t).setContent(e),t.$synced||(b(e,t),t.$synced=!0)};if(requestAnimationFrame in window?requestAnimationFrame(n):n(),window.Promise)return new Promise(function(t){setTimeout(function(){e.context.clearSyncCallbacks(),t()},300)});setTimeout(e.context.clearSyncCallbacks,300)},plug:function(e){return new _(e)}}});