"use strict";function _taggedTemplateLiteral(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var a,l=e[Symbol.iterator]();!(o=(a=l.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_templateObject=_taggedTemplateLiteral(['<span id="','" style="display: none" data-async-outlet>outlet</span>'],['<span id="','" style="display: none" data-async-outlet>outlet</span>']);!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=t():(e.yalla=t(),e.Context=e.Context||e.yalla.Context,e.render=e.render||e.yalla.render,e.plug=e.plug||e.yalla.plug,e.uuidv4=e.uuidv4||e.yalla.uuidv4,e.Event=e.Event||e.yalla.Event)}("undefined"!=typeof self?self:eval("this"),function(){var e="chrome"in window&&"webstore"in window.chrome,t={SYNCING_DONE:"syncingdone"},n=function(e){return"object"===(void 0===e?"undefined":_typeof(e))&&"constructor"in e&&"Promise"===e.constructor.name},o=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},r=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"destroy",value:function(){throw new Error("Please implement template.destroy ")}}]),e}(),i={INPUT:["VALUE"]},a={col:"colgroup",td:"tr",area:"map",tbody:"table",tfoot:"table",th:"tr",thead:"table",tr:"tbody",caption:"table",colgroup:"table",li:"ul",g:"svg",circle:"svg",rect:"svg",polygon:"svg",eclipse:"svg",text:"svg"},l=function(e,t,n){var o=e,r=t.map(function(e){return n[e]});return t.forEach(function(e,t){o=o.replace("\x3c!--"+e+"--\x3e",r[t])}),o},s=function(e){function t(e,n,o,r){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.items=e,i.keyFn="string"==typeof n?function(e){return e[n]}:n,i.templateFn=o,i.context=r,i.keys=[],i.templates={},i.initialzed=!1,i}return _inherits(t,r),_createClass(t,[{key:"iterateRight",value:function(e){if(this.initialzed)for(var t=this.keys.length-1;t>=0;){var n=this.items[t],o=this.keys[t],r=this.templates[o];e&&e.apply(null,[n,o,r,t]),t--}else{for(var i=this.items.length-1;i>=0;){var a=this.items[i],l=this.keyFn.apply(this,[a,i]),s=this.templateFn.apply(this,[a,i]);e&&e.apply(null,[a,l,s,i]),i--,this.keys.push(l),this.templates[l]=s}this.initialzed=!0,this.keys.reverse()}}}]),t}(),c=function(){function e(t){_classCallCheck(this,e),this.node=t,this.attributes={}}return _createClass(e,null,[{key:"from",value:function(t){var n=t;return t.nodeType===Node.ATTRIBUTE_NODE&&(n=t.ownerElement),n.$data=n.$data||new e(n),n.$data}}]),e}(),u=function(e){function s(e,t,n){_classCallCheck(this,s);var o=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return o.strings=e,o.values=t,o.context=n,o.key=o.strings.join("").trim(),o.nodeValueIndexArray=null,o.documentFragment=null,o}return _inherits(s,r),_createClass(s,[{key:"buildTemplate",value:function(e){this.documentFragment=s.getProperTemplateTag(e),this.nodeValueIndexArray=this.buildNodeValueIndex(this.documentFragment,this.documentFragment.nodeName),s.applyValues(this,this.nodeValueIndexArray)}},{key:"buildNodeValueIndex",value:function(e,t){var n=[],o=e.childNodes[0];if(void 0===o)return n;do{if(o.nodeType===Node.ELEMENT_NODE){for(var r=o.attributes,i=r.length,a=0;a<i;a++){var l=r[a].nodeValue,c=s.lookNodeValueArray(l).map(function(e){return e.match(/[\w\.]+/)[0]}).map(function(e){return parseInt(e)});c&&c.length>0&&n.push({node:r[a],valueIndexes:c,nodeValue:l})}n=n.concat(this.buildNodeValueIndex(o,o.nodeName))}if(o.nodeType===Node.TEXT_NODE&&"STYLE"===t.toUpperCase()){var u=o.nodeValue,d=s.lookNodeValueArray(u).map(function(e){return e.match(/[\w\.]+/)[0]}).map(function(e){return parseInt(e)});d&&d.length>0&&n.push({node:o,valueIndexes:d,nodeValue:u})}if(o.nodeType===Node.COMMENT_NODE){var f=o.nodeValue;o.nodeValue="outlet",n.push({node:o,valueIndexes:parseInt(f)})}o=o.nextSibling}while(o);return n}},{key:"constructTemplate",value:function(){if(!this.context.hasCache(this.key)){var e=this.buildStringSequence();return this.buildTemplate(e),this.context.cache(this.key,this)}for(var t=this.context.cache(this.key),n=t.documentFragment.querySelectorAll("span[data-async-outlet]"),o=n.length;o--;){var r=n[o];if(r.nextSibling){h.from(r.nextSibling).clearContent()}}return t}},{key:"buildStringSequence",value:function(){return this.strings.reduce(function(e,t,n){return 0===n?t:e+"\x3c!--"+(n-1)+"--\x3e"+t},"").trim()}}],[{key:"lookNodeValueArray",value:function(e){for(var t=[],n=e.indexOf("\x3c!--"),o=e.indexOf("--\x3e",n);o<e.length&&o>=0&&n>=0;)t.push(e.substring(n+4,o)),n=e.indexOf("\x3c!--",o+3),o=e.indexOf("--\x3e",n);return t}},{key:"getProperTemplateTag",value:function(e){var t=e.substring(1,e.indexOf(">"));t=(t.indexOf(" ")>0?t.substring(0,t.indexOf(" ")):t).toLowerCase();var n=a[t],o="svg"===(n=n||"div")?document.createElementNS("http://www.w3.org/2000/svg","svg"):document.createElement(n);return o.innerHTML=e,o}},{key:"applyValues",value:function(e,r){var i=e.values,a=e.context;r&&r.forEach(function(e){if(null!=e){var r=e.node,u=e.valueIndexes,d=e.values,f=Array.isArray(u)?u.map(function(e){return i[e]}):i[u],m=r.nodeName,p=r.nodeType===Node.ATTRIBUTE_NODE&&0===m.indexOf("on");if(!(function(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)&&e.length===t.length){for(var n=!0,o=0;o<t.length;o++)if(!(n=n&&e[o]===t[o]))return!1;return!0}return!1}(f,d)||p&&f[0].name)){if(r.nodeType===Node.ATTRIBUTE_NODE){var y=c.from(r),v=e.nodeValue;if(p){var C=u[0];r.ownerElement[m]=i[C],y.attributes[m]=i[C]}else{var N=i.reduce(function(e,t,o){return(t instanceof g||n(t))&&e.push({index:o,value:t}),e},[]);if(N.length>0){r.ownerElement.id=r.ownerElement.id||o();var x=r.ownerElement.id;a.addEventListener(t.SYNCING_DONE,function(){var e=document.getElementById(x);e||(e=a.root.getElementsByTagName("*")[x]),N.forEach(function(t){var o=t.index,r=t.value,a=o,l=e.getAttributeNode(m),u=function(t){var n=c.from(e).attributes[m],o=(n.nodeValue,n.valueIndexes);n.newValues;i[a]=t,s.updateAttributeValue(v,o,i,l)};r instanceof g&&r.factory.apply(null,[{node:l,name:m,getContent:function(){c.from(e).attributes[m].newValues;return i[a]},setContent:u}]),n(r)&&r.then(u)})})}else s.updateAttributeValue(v,u,i,r);y.attributes[m]={template:v,valueIndexes:u,templateValue:i}}}if(r.nodeType===Node.TEXT_NODE&&(r.nodeValue=l(e.nodeValue,u,i)),r.nodeType===Node.COMMENT_NODE){var b=i[u];h.from(r).setContent(b,a)}e.values=f}}})}},{key:"updateAttributeValue",value:function(e,t,n,o){var r=o.nodeName,a=l(e,t,n);if(!function(e){return["checked","compact","declare","defer","disabled","ismap","noresize","noshade","nowrap","selected"].indexOf(e.nodeName)>=0}(o)?(o.ownerElement.setAttribute(r,a),function(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),!!i[t]&&i[t].indexOf(e)>=0}(r,o.ownerElement.nodeName)&&(o.ownerElement[r]=a)):(o.ownerElement[r]="true"===a.trim(),o.ownerElement.setAttribute(r,"")),r.indexOf(".bind")>=0){var s=r.substring(0,r.indexOf(".bind"));o.ownerElement.setAttribute(s,a),o.ownerElement.removeAttribute(r)}return a}}]),s}(),d=function(){function e(){var t=this;_classCallCheck(this,e),this.cacheInstance={},this.syncCallbackStack=[],this.html=function(e){for(var n=arguments.length,o=Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];return new u(e,o,t)},this.htmlCollection=function(e,n,o){return new s(e,n,o,t)},this.listeners={}}return _createClass(e,[{key:"hasCache",value:function(e){return e in this.cacheInstance}},{key:"cache",value:function(e,t){return this.hasCache(e)||(this.cacheInstance[e]=t),this.cacheInstance[e]}},{key:"addSyncCallback",value:function(e){this.syncCallbackStack.push(e)}},{key:"addEventListener",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e+":"+o();this.listeners[e]=this.listeners[e]||[];return this.listeners[e].push({token:r,callback:t,calledOnce:n}),r}},{key:"removeEventListener",value:function(e){var t=e.split(":"),n=_slicedToArray(t,2),o=n[0],r=n[1],i=this.listeners[o];i=i.filter(function(e){return e.token!=r}),this.listeners[o]=i}},{key:"dispatchEvent",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(e in this.listeners){var r=this.listeners[e],i=[];r.forEach(function(e){if(e.callback.apply(null,n),e.calledOnce){var t=e.token.split(":"),o=_slicedToArray(t,2),r=(o[0],o[1]);i.push(r)}}),i.length>0&&(r=r.filter(function(e){return i.indexOf(e.token)<0})),this.listeners[e]=r}}},{key:"clearSyncCallbacks",value:function(){this.syncCallbackStack.forEach(function(e){return e.apply()}),this.syncCallbackStack=[],this.dispatchEvent(t.SYNCING_DONE)}}]),e}(),f=function(e,t){var n=document.getElementById(e);if(n||(n=t.root.getElementsByTagName("*")[e]),n){var o=n.nextSibling;return n.remove(),h.from(o)}return!1},h=function(){function e(t){_classCallCheck(this,e),this.commentNode=t,this.content=null}return _createClass(e,[{key:"constructTextContent",value:function(){this.content=this.commentNode.previousSibling}},{key:"constructHtmlTemplateCollectionContent",value:function(e){var t=this;this.content=new m(e,this),this.content.instance={};var n=this.commentNode;e.iterateRight(function(e,o){do{n=n.previousSibling}while(n.nodeType!==Node.COMMENT_NODE&&"outlet-child"!==n.nodeValue);t.content.instance[o]=n})}},{key:"constructHtmlTemplateContent",value:function(e){if(void 0!==e){var t=e.context.cache(e.key).documentFragment.childNodes.length;this.content=new p(e,this);for(var n=this.commentNode;t--;)n=n.previousSibling,this.content.instance.push(n);this.content.instance.reverse()}}},{key:"makeTemporaryOutlet",value:function(e){var t=o();return this.setHtmlTemplateContent(e.html(_templateObject,t)),t}},{key:"setContent",value:function(e,o){var r=this;if(n(e))if(null===this.content){var i=this.makeTemporaryOutlet(o);e.then(function(e){var t=f(i,o);t&&(t.setContent(e),C(e,t.commentNode))})}else e.then(function(e){r.setContent(e)});else if(e instanceof g)if(null===this.content){var a=this.makeTemporaryOutlet(o);o.addEventListener(t.SYNCING_DONE,function(){var t=f(a,o);t&&e.factory.apply(null,[{getContent:function(){return t.currentContent},setContent:function(e){t.setContent.apply(t,[e]),t.currentContent=e}}])},!0)}else{var l=this;e.factory.apply(null,[{getContent:function(){return l.currentContent},setContent:function(e){l.setContent.apply(l,[e]),l.currentContent=e}}])}else e instanceof u?this.setHtmlTemplateContent(e):e instanceof s?this.setHtmlTemplateCollectionContent(e):this.setTextContent(e)}},{key:"setTextContent",value:function(e){this.content instanceof Text?this.content.nodeValue=e:(this.clearContent(),this.content=document.createTextNode(e),this.commentNode.parentNode.insertBefore(this.content,this.commentNode))}},{key:"setHtmlTemplateCollectionContent",value:function(e){var t=!1;!this.content||this.content instanceof m||(t=!0,this.clearContent()),this.content=this.content||new m(e,this),this.content.applyValues(e),t&&C(e,this.commentNode)}},{key:"setHtmlTemplateContent",value:function(e){var t=!1,n=!!(this.content&&this.content instanceof p)&&this.content.template.key===e.key;if(null===this.content||n||(this.clearContent(),t=!0),!this.content){var o=e.constructTemplate();this.content=new p(o,this)}this.content.applyValues(e),t&&C(e,this.commentNode)}},{key:"clearContent",value:function(){null!==this.content&&(this.content instanceof r?this.content.destroy():this.content.remove(),this.content=null)}},{key:"firstChildNode",value:function(){if(this.content instanceof p)return this.content.instance[0];if(this.content instanceof m){var t=this.content.template.keys[0];return e.from(this.content.instance[t]).firstChildNode()}return this.content}},{key:"validateInstancePosition",value:function(){this.content instanceof p?this.content.instance.reduceRight(function(e,t){return e.previousSibling!==t&&e.parentNode.insertBefore(t,e),t},this.commentNode):this.content instanceof m||this.commentNode.previousSibling!==this.content&&this.commentNode.parentNode.insertBefore(this.content,this.commentNode)}}],[{key:"from",value:function(t){return t instanceof Comment?(t.$data=t.$data||new e(t),t.$data):(t.$outlet||(t.$outlet=document.createComment("outlet"),t.appendChild(t.$outlet)),e.from(t.$outlet))}}]),e}(),m=function(e){function t(e,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.template=e,o.outlet=n,o.instance=null,o}return _inherits(t,r),_createClass(t,[{key:"applyValues",value:function(e){var t=this,n=e.context;if(null===this.instance){this.instance={};var o=this.outlet.commentNode;e.iterateRight(function(e,r,i){var a=h.from(document.createComment("outlet-child"));o.parentNode.insertBefore(a.commentNode,o),h.from(a.commentNode).setContent(i,n),o=a.firstChildNode(),t.instance[r]=a.commentNode})}else{if(e.iterateRight(),0===e.items.length){if(this.outlet.commentNode.parentNode.$htmlCollectionInstanceChild&&1===this.outlet.commentNode.parentNode.$htmlCollectionInstanceChild.length){var r=this.outlet.commentNode.parentNode;r.innerText="",r.appendChild(this.outlet.commentNode),this.instance={}}}else{this.template.keys.forEach(function(n){if(e.keys.indexOf(n)<0){var o=t.instance[n];h.from(o).clearContent(),o.remove(),delete t.instance[n]}})}var i=this.outlet.commentNode;e.iterateRight(function(e,o,r){var a=t.instance[o];if(a){var l=h.from(a);l.setContent(r),i.previousSibling!==a&&(i.parentNode.insertBefore(a,i),l.validateInstancePosition()),i=l.firstChildNode()}else{var s=h.from(document.createComment("outlet-child"));i.parentNode.insertBefore(s.commentNode,i),h.from(s.commentNode).setContent(r,n),i=s.firstChildNode(),t.instance[o]=s.commentNode,t.template.context.addSyncCallback(function(){return C(r,s.commentNode)})}}),this.template=e}}},{key:"destroy",value:function(){var e=this;this.template.keys.forEach(function(t){var n=e.instance[t];h.from(n).clearContent(),n.remove(),delete e.instance[t]}),this.outlet=null,this.instance=null,this.template=null}}]),t}(),p=function(t){function n(e,t){_classCallCheck(this,n);var o=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return o.template=e,o.outlet=t,o.instance=[],o.nodeValueIndexArray=null,o}return _inherits(n,r),_createClass(n,[{key:"applyValues",value:function(t){if(null===this.instance||0===this.instance.length){u.applyValues(t,this.template.nodeValueIndexArray);var n=function t(n){if(e)return n.cloneNode(!0);for(var o=3===n.nodeType?document.createTextNode(n.nodeValue):n.cloneNode(!1),r=n.firstChild;r;)o.appendChild(t(r)),r=r.nextSibling;return o}(this.template.documentFragment),o=this.outlet.commentNode,r=n.childNodes[0],i=null;do{this.instance.push(r),i=r.nextSibling,o.parentNode.insertBefore(r,o),r=i}while(r)}else this.nodeValueIndexArray&&u.applyValues(t,this.nodeValueIndexArray)}},{key:"destroy",value:function(){this.instance.forEach(function(e){return e.remove()}),this.nodeValueIndexArray=null,this.outlet=null,this.template=null}}]),n}(),y=function(e,t,n,o){var r=c.from(e),i=e.nodeName;if(0===i.indexOf("on")){var a=t[0];!function(e,t){if(!e||"function"!=typeof e)throw new Error(t)}(n[a],"Event listener "+e.nodeName+" should be a function (event) => {}'"),r.attributes[i]=n[a],e.ownerElement.setAttribute(i,"return false;"),e.ownerElement[i]=n[a]}else r.attributes[i]={template:o,valueIndexes:t,templateValue:n}},v=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=e.nodeValue,r=e.valueIndexes,i=function(e,t){return e.reduce(function(e,t){return"number"==typeof t?e.childNodes[t]:e.attributes[t.name]},t)}(function e(t){if(t.nodeType===Node.ATTRIBUTE_NODE)return e(t.ownerElement).concat([{name:t.nodeName}]);for(var n=0,o=t;null!==(o=o.previousSibling);)n++;var r=[];return r.push(n),t.parentNode&&t.parentNode.parentNode?e(t.parentNode).concat(r):r}(e.node),t);if(i){var a=Array.isArray(r)?r.map(function(e){return n[e]}):n[r];return i.parentNode&&"STYLE"===i.parentNode.nodeName.toUpperCase()?{node:i,valueIndexes:r,nodeValue:o,values:a}:i.nodeType===Node.ATTRIBUTE_NODE?(y(i,r,n,o),{node:i,valueIndexes:r,nodeValue:o,values:a}):(function(e,t,n){var o=h.from(e),r=t[n];r instanceof u?(o.constructHtmlTemplateContent(r),C(r,o.commentNode)):r instanceof s?(o.constructHtmlTemplateCollectionContent(r),C(r,o.commentNode)):o.constructTextContent()}(i,n,r),{node:i,valueIndexes:r,values:a})}},C=function e(t,n){var o=h.from(n);if(o.content&&o.content instanceof p){var r=o.content,i=r.template,a=t.values,l={childNodes:r.instance};if(null===i.nodeValueIndexArray){var s=i.context.cache(i.key);l={childNodes:o.content.instance},r.nodeValueIndexArray=s.nodeValueIndexArray.map(function(e){return v(e,l,a)})}else r.nodeValueIndexArray=i.nodeValueIndexArray.map(function(e){return v(e,l,a)})}if(o.content&&o.content instanceof m){var c=o.content,d=c.template.templates,f=c.template.keys;o.commentNode.parentNode.$htmlCollectionInstanceChild=o.commentNode.parentNode.$htmlCollectionInstanceChild||[],o.commentNode.parentNode.$htmlCollectionInstanceChild.push(o.commentNode),f.forEach(function(t){var n=d[t],o=c.instance[t],r=h.from(o);null===r.content?n instanceof u&&(r.constructHtmlTemplateContent(n.context.cache(n.key)),e(n,o)):r.content instanceof p&&e(n,o)})}},N=function(e,t){t.$synced||(C(e,t),t.$synced=!0)},x=function(e,t){e.context.root=e.context.root||t,h.from(t).setContent(e)},b=function(e){"requestIdleCallback"in window?requestIdleCallback(e):e()},g=function e(t){_classCallCheck(this,e),this.factory=t};return{Context:d,render:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if("Promise"in window)return new Promise(function(o){var r=function(){x.apply(null,[e,t]),o()};n?function(e){"requestAnimationFrame"in window?requestAnimationFrame(e):e()}(r):b(r)}).then(function(){return new Promise(function(n){b(function(){N.apply(null,[e,t]),n()})})}).then(function(){return new Promise(function(t){b(function(){e.context.clearSyncCallbacks(),t()})})});var o={then:function(){}};return setTimeout(function(){x(e,t),N(e,t),e.context.clearSyncCallbacks(),o.then.apply(null,[])},0),o},plug:function(e){return new g(e)},uuidv4:o,Event:t}});