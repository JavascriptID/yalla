"use strict";function _taggedTemplateLiteral(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_templateObject=_taggedTemplateLiteral(['<span id="','" style="color : #bbbbbb;border : 1px solid #bbbbbb;border-radius: 5px;padding: 2px;">outlet</span>'],['<span id="','" style="color : #bbbbbb;border : 1px solid #bbbbbb;border-radius: 5px;padding: 2px;">outlet</span>']);!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=t():(e.yalla=t(),e.Context=e.yalla.Context,e.render=e.yalla.render,e.plug=e.yalla.plug)}("undefined"!=typeof self?self:eval("this"),function(){function e(t){if(t.nodeType===Node.ATTRIBUTE_NODE)return e(t.ownerElement).concat([{name:t.nodeName}]);for(var n=0,o=t;null!=(o=o.previousSibling);)n++;var r=[];return r.push(n),t.parentNode&&t.parentNode.parentNode?e(t.parentNode).concat(r):r}function t(e,t){return e.reduce(function(e,t){return"number"==typeof t?e.childNodes[t]:e.attributes[t.name]},t)}function n(o,r){var i=h.from(r);if(i.content&&i.content instanceof l){var a=i.content,f=a.template,m=o.values,p={childNodes:a.instance};if(null==f.nodeValueIndexArray){var y=f.context.cache(f.key),v={childNodes:i.content.instance};a.nodeValueIndexArray=y.nodeValueIndexArray.map(function(o){var r=o.node,i=o.nodeValue,a=o.valueIndexes,s=t(e(r),v),l=Array.isArray(a)?a.map(function(e){return m[e]}):m[a];if(s.parentNode&&"STYLE"===s.parentNode.nodeName.toUpperCase())return{node:s,valueIndexes:a,nodeValue:i,values:l};if(s.nodeType===Node.ATTRIBUTE_NODE){var f=d.from(s),p=s.nodeName;if(0===p.indexOf("on")){var y=a[0];f.attributes[p]=m[y];p.substring(2,p.length);s.ownerElement.setAttribute(p,"return false;"),s.ownerElement[p]=m[y]}else{var b=i,x=a.map(function(e){return m[e]});a.forEach(function(e,t){b=b.replace("\x3c!--"+e+"--\x3e",x[t])}),f.attributes[p]=b}return{node:s,valueIndexes:a,nodeValue:i,values:l}}var C=h.from(s),N=m[a];return N instanceof u?(C.constructHtmlTemplateContent(N),n(N,C.commentNode)):N instanceof c?(C.constructHtmlTemplateCollectionContent(N),n(N,C.commentNode)):C.constructTextContent(),{node:s,valueIndexes:a,values:l}})}else a.nodeValueIndexArray=f.nodeValueIndexArray.map(function(o){var r=o.nodeValue,i=o.valueIndexes,a=t(e(o.node),p),s=Array.isArray(i)?i.map(function(e){return m[e]}):m[i];if(a.parentNode&&"STYLE"===a.parentNode.nodeName.toUpperCase())return{node:a,valueIndexes:i,nodeValue:r,values:s};if(a.nodeType===Node.ATTRIBUTE_NODE){var l=d.from(a),f=a.nodeName;if(0===f.indexOf("on")){var y=i[0];l.attributes[f]=m[y];f.substring(2,f.length);a.ownerElement.setAttribute(f,"return false;"),a.ownerElement[f]=m[y]}else{var v=r,b=i.map(function(e){return m[e]});i.forEach(function(e,t){v=v.replace("\x3c!--"+e+"--\x3e",b[t])}),l.attributes[f]=v}return{node:a,valueIndexes:i,nodeValue:r,values:s}}var x=h.from(a),C=m[i];return C instanceof u?(x.constructHtmlTemplateContent(C),n(C,x.commentNode)):C instanceof c?(x.constructHtmlTemplateCollectionContent(C),n(C,x.commentNode)):x.constructTextContent(),{node:a,valueIndexes:i,values:s}})}if(i.content&&i.content instanceof s){var b=i.content,x=b.template.templates;b.template.keys.forEach(function(e){var t=x[e],o=b.instance[e],r=h.from(o);null===r.content?t instanceof u&&(r.constructHtmlTemplateContent(t.context.cache(t.key)),n(t,o)):r.content instanceof l&&n(t,o)})}}var o=!!window.chrome&&!!window.chrome.webstore,r=function(){function e(){var t=this;_classCallCheck(this,e),this._cache={},this._synccallbacks=[],this.html=function(e){for(var n=arguments.length,o=Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];return new u(e,o,t)},this.htmlCollection=function(e,n,o){return new c(e,n,o,t)}}return _createClass(e,[{key:"hasCache",value:function(e){return e in this._cache}},{key:"cache",value:function(e,t){return this.hasCache(e)||(this._cache[e]=t),this._cache[e]}},{key:"addSyncCallback",value:function(e){this._synccallbacks.push(e)}},{key:"clearSyncCallbacks",value:function(){this._synccallbacks.forEach(function(e){e.apply()}),this._synccallbacks=[]}}]),e}(),i=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"destroy",value:function(){console.log("WARNING NOT IMPLEMENTED YET ")}}]),e}(),a={col:"colgroup",td:"tr",area:"map",tbody:"table",tfoot:"table",th:"tr",thead:"table",tr:"tbody",caption:"table",colgroup:"table",li:"ul",g:"svg",circle:"svg",rect:"svg",polygon:"svg",eclipse:"svg",text:"svg"},s=function(e){function t(e,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.template=e,o.outlet=n,o.instance=null,o}return _inherits(t,i),_createClass(t,[{key:"applyValues",value:function(e){var o=this;if(null===this.instance){this.instance={};var r=this.outlet.commentNode;e.iterateRight(function(e,t,n){var i=h.from(document.createComment("outlet-child"));r.parentNode.insertBefore(i.commentNode,r),h.from(i.commentNode).setContent(n),r=i.firstChildNode(),o.instance[t]=i.commentNode})}else{e.iterateRight();this.template.keys.forEach(function(t){if(e.keys.indexOf(t)<0){var n=o.instance[t];h.from(n).clearContent(),n.parentNode.removeChild(n),delete o.instance[t]}});var i=this.outlet.commentNode;e.iterateRight(function(e,r,a){var s=o.instance[r];if(s){var c=h.from(s);c.content instanceof l?c.setHtmlTemplateContent(a):c.content instanceof t?c.setHtmlTemplateCollectionContent(a):c.setTextContent(a),i.previousSibling!=s&&(i.parentNode.insertBefore(s,i),c.validateInstancePosition()),i=c.firstChildNode()}else{var u=h.from(document.createComment("outlet-child"));i.parentNode.insertBefore(u.commentNode,i),h.from(u.commentNode).setContent(a),i=u.firstChildNode(),o.instance[r]=u.commentNode,o.template.context.addSyncCallback(function(){n(a,u.commentNode)})}}),this.template=e}}},{key:"destroy",value:function(){var e=this;this.template.keys.forEach(function(t){var n=e.instance[t],o=h.from(n);o.content instanceof i?o.content.destroy():o.content.parentNode.removeChild(o.content),n.parentNode.removeChild(n),delete e.instance[t]}),this.outlet=null,this.instance=null,this.template=null}}]),t}(),l=function(e){function t(e,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.template=e,o.outlet=n,o.instance=[],o.nodeValueIndexArray=null,o}return _inherits(t,i),_createClass(t,[{key:"applyValues",value:function(e){if(null===this.instance||0===this.instance.length){u.applyValues(e,this.template.nodeValueIndexArray);var t=function e(t){if(o)return t.cloneNode(!0);for(var n=3==t.nodeType?document.createTextNode(t.nodeValue):t.cloneNode(!1),r=t.firstChild;r;)n.appendChild(e(r)),r=r.nextSibling;return n}(this.template.documentFragment),n=this.outlet.commentNode,r=t.childNodes[0],i=null;do{this.instance.push(r),i=r.nextSibling,n.parentNode.insertBefore(r,n)}while(r=i)}else this.nodeValueIndexArray&&u.applyValues(e,this.nodeValueIndexArray)}},{key:"destroy",value:function(){this.instance.forEach(function(e){return e.parentNode.removeChild(e)}),this.nodeValueIndexArray=null,this.outlet=null,this.template=null}}]),t}(),c=function(e){function t(e,n,o,r){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.items=e,i.keyFn="string"==typeof n?function(e){return e[n]}:n,i.templateFn=o,i.context=r,i.keys=[],i.templates={},i.initialzed=!1,i}return _inherits(t,i),_createClass(t,[{key:"iterateRight",value:function(e){if(this.initialzed)for(var t=this.keys.length-1;t>=0;){var n=this.items[t],o=this.keys[t],r=this.templates[o];e&&e.apply(null,[n,o,r,t]),t--}else{for(var i=this.items.length-1;i>=0;){var a=this.items[i],s=this.keyFn.apply(this,[a,i]),l=this.templateFn.apply(this,[a,i]);e&&e.apply(null,[a,s,l,i]),i--,this.keys.push(s),this.templates[s]=l}this.initialzed=!0,this.keys.reverse()}}}]),t}(),u=function(e){function t(e,n,o){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.strings=e,r.values=n,r.context=o,r.key=r.strings.join("").trim(),r.nodeValueIndexArray=null,r.documentFragment=null,r}return _inherits(t,i),_createClass(t,[{key:"buildTemplate",value:function(e){this.documentFragment=t.getProperTemplateTag(e),this.nodeValueIndexArray=this.buildNodeValueIndex(this.documentFragment,this.documentFragment.nodeName),t.applyValues(this,this.nodeValueIndexArray)}},{key:"buildNodeValueIndex",value:function(e,n){var o=[],r=e.childNodes[0];if(void 0===r)return o;do{if(r.nodeType===Node.ELEMENT_NODE){for(var i=r.attributes,a=i.length,s=0;s<a;s++){var l=i[s].nodeValue,c=t.lookNodeValueArray(l);if(0!=c.length){var u=c.map(function(e){return e.match(/[\w\.]+/)[0]}).map(function(e){return parseInt(e)});u&&u.length>0&&o.push({node:i[s],valueIndexes:u,nodeValue:l})}}o=o.concat(this.buildNodeValueIndex(r,r.nodeName))}if(r.nodeType===Node.TEXT_NODE&&"STYLE"===n.toUpperCase()){var d=r.nodeValue,f=t.lookNodeValueArray(d);if(0==f.length)continue;var h=f.map(function(e){return e.match(/[\w\.]+/)[0]}).map(function(e){return parseInt(e)});h&&h.length>0&&o.push({node:r,valueIndexes:h,nodeValue:d})}if(r.nodeType===Node.COMMENT_NODE){var m=r.nodeValue;r.nodeValue="outlet",o.push({node:r,valueIndexes:parseInt(m)})}}while(r=r.nextSibling);return o}},{key:"constructTemplate",value:function(){if(!this.context.hasCache(this.key)){var e=this.buildStringSequence();return this.buildTemplate(e),this.context.cache(this.key,this)}return this.context.cache(this.key)}},{key:"buildStringSequence",value:function(){return this.strings.reduce(function(e,t,n){return 0==n?t:e+"\x3c!--"+(n-1)+"--\x3e"+t},"").trim()}}],[{key:"lookNodeValueArray",value:function(e){for(var t=[],n=e.indexOf("\x3c!--"),o=e.indexOf("--\x3e",n);o<e.length&&o>=0&&n>=0;)t.push(e.substring(n+4,o)),n=e.indexOf("\x3c!--",o+3),o=e.indexOf("--\x3e",n);return t}},{key:"getProperTemplateTag",value:function(e){var t=e.substring(1,e.indexOf(">"));t=(t.indexOf(" ")>0?t.substring(0,t.indexOf(" ")):t).toLowerCase();var n=a[t];n=n||"div";var o=document.createElement(n);return o.innerHTML=e,o}},{key:"applyValues",value:function(e,t){var n=e.values;t&&t.forEach(function(e,t){var o=e.node,r=e.valueIndexes,i=e.values,a=Array.isArray(r)?r.map(function(e){return n[e]}):n[r];if(!function(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)&&e.length==t.length){for(var n=!0,o=0;o<t.length;o++)if(!(n=n&&e[o]===t[o]))return!1;return!0}return!1}(a,i)){var s=o.nodeName;if(o.nodeType===Node.ATTRIBUTE_NODE){var l=d.from(o),c=0===s.indexOf("on"),u=e.nodeValue;if(c){var f=r[0];o.ownerElement[s]=n[f],l.attributes[s]=n[f]}else{var m=u,p=r.map(function(e){return n[e]});if(r.forEach(function(e,t){m=m.replace("\x3c!--"+e+"--\x3e",p[t])}),!function(e){return["checked","compact","declare","defer","disabled","ismap","noresize","noshade","nowrap","selected"].indexOf(e.nodeName)>=0}(o)?(o.ownerElement.setAttribute(s,m),function(e,t){return!("VALUE"!==e.toUpperCase()||"INPUT"!==t.toUpperCase())}(s,o.ownerElement.nodeName)&&(o.ownerElement[s]=m)):(o.ownerElement[s]="true"==m.trim(),o.ownerElement.setAttribute(s,"")),s.indexOf(".bind")>=0){var y=s.substring(0,s.indexOf(".bind"));o.ownerElement.setAttribute(y,m)}l.attributes[s]=m}}if(o.nodeType===Node.TEXT_NODE){var v=e.nodeValue,b=r.map(function(e){return n[e]});r.forEach(function(e,t){v=v.replace("\x3c!--"+e+"--\x3e",b[t])}),o.nodeValue=v}if(o.nodeType===Node.COMMENT_NODE){o.nodeValue;var x=n[r];h.from(o).setContent(x)}e.values=a}})}}]),t}(),d=function(){function e(t){_classCallCheck(this,e),this.node=t,this.attributes={}}return _createClass(e,null,[{key:"from",value:function(t){var n=t;return t.nodeType===Node.ATTRIBUTE_NODE&&(n=t.ownerElement),n.$data=n.$data||new e(n),n.$data}}]),e}(),f=(new r).html,h=function(){function e(t){_classCallCheck(this,e),this.commentNode=t,this.content=null}return _createClass(e,[{key:"constructTextContent",value:function(){this.content=this.commentNode.previousSibling}},{key:"constructHtmlTemplateCollectionContent",value:function(e){var t=this;this.content=new s(e,this),this.content.instance={};var n=this.commentNode;e.iterateRight(function(e,o,r,i){do{n=n.previousSibling}while(n.nodeType!=Node.COMMENT_NODE&&"outlet-child"!==n.nodeValue);t.content.instance[o]=n})}},{key:"constructHtmlTemplateContent",value:function(e){var t=e.context.cache(e.key).documentFragment.childNodes.length;this.content=new l(e,this);for(var n=this.commentNode;t--;)n=n.previousSibling,this.content.instance.push(n);this.content.instance.reverse()}},{key:"setContent",value:function(t){var n=this;if(function(e){return!!("object"===(void 0===e?"undefined":_typeof(e))&&"constructor"in e&&"Promise"===e.constructor.name)}(t))if(null===this.content){var o=this,r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)});this.setHtmlTemplateContent(f(_templateObject,r)),t.then(function(t){var n=document.getElementById(r).nextSibling;e.from(n).setContent(t),o.clearContent()})}else t.then(function(e){n.setContent(e)});else t instanceof m?t.factory.apply(null,[this]):t instanceof u?this.setHtmlTemplateContent(t):t instanceof c?this.setHtmlTemplateCollectionContent(t):this.setTextContent(t)}},{key:"setTextContent",value:function(e){this.content instanceof Text?this.content.nodeValue=e:(this.clearContent(),this.content=document.createTextNode(e),this.commentNode.parentNode.insertBefore(this.content,this.commentNode))}},{key:"setHtmlTemplateCollectionContent",value:function(e){var t=!1,o=this.content&&this.content instanceof s;null===this.content||o||(t=!0,this.clearContent()),this.content||(this.content=new s(e,this)),this.content.applyValues(e),t&&n(e,this.commentNode)}},{key:"setHtmlTemplateContent",value:function(e){var t=!1,o=!!(this.content&&this.content instanceof l)&&this.content.template.key===e.key;if(null===this.content||o||(this.clearContent(),t=!0),!this.content){var r=e.constructTemplate();this.content=new l(r,this)}this.content.applyValues(e),t&&n(e,this.commentNode)}},{key:"clearContent",value:function(){null!==this.content&&(this.content instanceof i?this.content.destroy():this.content.parentNode.removeChild(this.content),this.content=null)}},{key:"firstChildNode",value:function(){if(this.content instanceof l)return this.content.instance[0];if(this.content instanceof s){var t=this.content.template.keys[0];return e.from(this.content.instance[t]).firstChildNode()}return this.content}},{key:"validateInstancePosition",value:function(){this.content instanceof l?this.content.instance.reduceRight(function(e,t){return e.previousSibling!=t&&e.parentNode.insertBefore(t,e),t},this.commentNode):this.content instanceof s||this.commentNode.previousSibling!=this.content&&this.commentNode.parentNode.insertBefore(this.content,this.commentNode)}}],[{key:"from",value:function(t){return t instanceof Comment?(t.$data=t.$data||new e(t),t.$data):(t.$outlet||(t.$outlet=document.createComment("outlet"),t.appendChild(t.$outlet)),e.from(t.$outlet))}}]),e}(),m=function e(t){_classCallCheck(this,e),this.factory=t};return{Context:r,render:function(e,t){if(h.from(t).setContent(e),t.$synced||(n(e,t),t.$synced=!0),"Promise"in window)return new Promise(function(t){setTimeout(function(){e.context.clearSyncCallbacks(),t()},300)});setTimeout(function(){e.context.clearSyncCallbacks()},300)},plug:function(e){return new m(e)}}});